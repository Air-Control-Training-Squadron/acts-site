---
layout: page
---

<div id="map"></div>

<h2>Business schedules</h2>

<!-- identifies unique service types -->
{% assign service_types = "" | split: "," %}

{% for business in site.data.businesses %}
{% unless service_types contains business.service_type %}
{% assign service_types = service_types | push: business.service_type %}
{% endunless %}
{% endfor %}

<ul class="nav nav-tabs" id="businessTab" role="tablist">
  {% for service_type in service_types %}
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if forloop.first %}active{% endif %}" id="{{ service_type | slugify }}-tab"
      data-bs-toggle="tab" data-bs-target="#{{ service_type | slugify }}" type="button" role="tab"
      aria-controls="{{ service_type | slugify }}" aria-selected="{{ forloop.first | yesno: 'true', 'false' }}">{{
      service_type | capitalize }}</button>
  </li>
  {% endfor %}
</ul>

<div class="tab-content pt-4" id="businessTabContent">
  {% for service_type in service_types %}
  <div class="tab-pane fade show {% if forloop.first %}active{% endif %}" id="{{ service_type | slugify }}"
    role="tabpanel" aria-labelledby="{{ service_type | slugify }}-tab">
    <!-- card grid -->
    <div class="container">
      <div class="row">
        {% for business in site.data.businesses %}
        {% if business.service_type == service_type %}
        <div class="col-md-4 mb-4">
          <div class="card">
            <div class="card-header text-center">
              <a href="#" class="card-link" data-building="{{ business.building_id }}">{{ business.name }}</a>
            </div>
            <div class="card-body p-1">
              <table class="table mx-auto table-striped" style="width: 100%;">
                <thead>
                  <tr>
                    <td colspan="2" class="text-center">Hours</td>
                  </tr>
                </thead>
                <tbody>
                  {% for time in business.hours %}
                  <tr>
                    <td class="p-1">{{ time.day | capitalize }}</td>
                    <td class="p-1">
                      {% for hour in time.times %}
                      {{ hour.open }} - {{ hour.close }}
                      {% unless forloop.last %}<br>{% endunless %}
                      {% endfor %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Map code -->
<script src="{{ site.data.origin.cors.leaflet.js }}" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
  crossorigin=""></script>

<script defer>
  var map = L.map('map', {
    attributionControl: false
  }).setView([34.2392, -116.0587], 17);

  L.control.attribution({
    prefix: false
  }).addTo(map);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  }).addTo(map);

  fetch('{{ "/assets/mapgeo.json" | relative_url }}')
    .then(response => response.json())
    .then(data => {
      /* highlight buildings */
      L.geoJSON(data, {
        style: function (feature) {
          switch (feature.properties.buildingType) {
            case "classroom":
              return { color: "#0588fa" }
            case "barracks":
              return { color: "#4bf218" }
            case "amenity":
              return { color: "#faf205" }
            case "office":
              return { color: "#4992d1" }
            case "medical":
              return { color: "#ff0000" }
            case "chowhall":
              return { color: "#fa9511" }
          }
        },
        onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.buildingName || feature.properties.buildingNum)
        }
      }).addTo(map);

      /* create clickable links which zoom on map */
      $('.card-header .card-link').click(function (event) {
        event.preventDefault();

        $('html, body').animate({
          scrollTop: $('#map').offset().top - offset
        }, 100);

        var buildingId = $(this).data('building');

        $('#map').get(0).scrollIntoView({ behavior: 'smooth' });

        var buildingData = data.features.find(function (feature) {
          return feature.properties.buildingId === buildingId;
        });

        if (buildingData) {
          var buildingCoordinates = buildingData.geometry.coordinates[0];
          var buildingLatLngs = buildingCoordinates.map(function (coord) {
            return L.latLng(coord[1], coord[0]);
          });

          map.flyToBounds(buildingLatLngs);

          var mapHeight = $('#map').height();
          var viewportHeight = $(window).height();
          var offset = (viewportHeight - mapHeight) / 2;
        }
      });
    });

</script>